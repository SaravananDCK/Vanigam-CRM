@typeparam TParent where TParent : class, IHasId<Guid>
@typeparam TChild where TChild : class, IHasId<Guid>
@using Vanigam.CRM.Objects.Contracts
@using Vanigam.CRM.Objects.OData
@using Vanigam.CRM.Helpers
@using Microsoft.AspNetCore.Components.Web
@using Radzen
@using System.Reflection
@using Vanigam.CRM.Client.Components
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<NestedListView<TChild,TChild>> Localizer
@inject NotificationService NotificationService
@inject DialogService DialogService
@inject IServiceProvider ServiceProvider

<RadzenStack>
    <ListPageTitleComponent TitleText="@Title"
                            AddButtonClick="@AddButtonClick"
                            SearchButtonClick="@Search"
                            ShowAdd="@ShowAddButton" />
    <RadzenRow>
        <RadzenColumn SizeMD=12 class="datagrid-container-standard">
            <VanigamAccountingDataGrid @ref="GridControl"
                                       AllowColumnPicking="@AllowColumnPicking"
                                       Data="@DataSource"
                                       Count="Count"
                                       TItem="TChild"
                                       VanigamAccountingLoadData="@GridLoadData"
                                       RowDoubleClick="@EditRow"
                                       @bind-Settings="@Settings"
                                       PageSize="@PageSize"
                                       PageSizeOptions="@PageSizeOptions"
                                       LoadSettings="@LoadGridSettings">
                <EmptyTemplate>
                    <NoRecordComponent ShowAddButton="false" />
                </EmptyTemplate>
                <Columns>
                    <RadzenDataGridColumn TItem="TChild" Filterable="false" Sortable="false" Width="120px" Title="@Localizer["Actions"]">
                        <Template Context="item">
                            @if (CustomActionsTemplate != null)
                            {
                                @CustomActionsTemplate(item)
                            }
                            else
                            {
                                <OpenPageCommonComponent T="TChild" OpenObject="@item" Open="@Open"></OpenPageCommonComponent>
                                <DeletePageCommonComponent T="TChild" UsingObject="@item" GridDeleteButtonClick="@GridDeleteButtonClick"></DeletePageCommonComponent>
                            }
                        </Template>
                        <FooterTemplate>@Localizer["Count"]: <b>@Count</b></FooterTemplate>
                    </RadzenDataGridColumn>

                    @if (CustomColumns != null)
                    {
                        @CustomColumns
                    }
                    else
                    {
                        @* Default columns will be rendered based on entity properties *@
                        @RenderDefaultColumns()
                    }

                    <RadzenDataGridColumn TItem="TChild" Property="Oid" Title="@Localizer["Oid"]" Visible="false">
                    </RadzenDataGridColumn>
                </Columns>
            </VanigamAccountingDataGrid>
        </RadzenColumn>
    </RadzenRow>
</RadzenStack>

@code {

    // Grid state

    // Dynamic API service

}